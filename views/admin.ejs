<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>卡卡貓catcatmed | 管理員</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="shortcut icon" type="image/png" href="../images/favicon.png"/>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
</head>
<body>
    <nav class="navbar navbar-expand-lg fixed-top navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="#">卡卡貓管理員用介面</a>
            <a class="navbar-brand" href="#" style="font-size: 0.9em;">catcatmed admin page</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link active" href='#' id="homepage" onclick="ChangePage(this.id)">首頁</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href='#' id="customerAccount" onclick="ChangePage(this.id)">顧客帳號管理</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href='#' id="questionnaireView" onclick="ChangePage(this.id)">問卷檢視</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <div style="margin: 10vh;"></div>
    <div class="container">
        <div class="row" id="loginBlock">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <span>帳號: </span><input type="text" id="id" onKeyDown="EnterPress()">
                <br>
                <span>密碼: </span><input type="password" id="pwd" onKeyDown="EnterPress()">
                <button onclick="SendAdminInfo()">Submit</button>
                <hr>
            </div>
        </div>
        <div class="row d-none" id="homepageBlock">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <h3>歡迎來到管理員介面，<span id="adminName"></span></h3>
                <br>
                <h4>目前實作的功能:</h4>
                <ul>
                    <li>檢視會員資料</li>
                    <li>檢視會員填寫問卷情形</li>
                </ul>
                <hr>
                <h5>最後更新於:2018/12/20 09:36 a.m.</h5>
            </div>
        </div>
        <div class="row d-none" id="customerAccountBlock">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <table class="table table-hover table-dark">
                <thead>
                    <tr>
                    <th scope="col">Index</th>
                    <th scope="col">姓名</th>
                    <th scope="col">帳號</th>
                    <th scope="col">密碼</th>
                    <th scope="col">建構時間</th>
                    <th scope="col">評論狀態</th>
                    <th scope="col">可能購買飼料</th>
                    </tr>
                </thead>
                <tbody id="customerAccountInfo">
                    <tr>
                        <th scope="row">1</th>
                        <td>Mark</td>
                        <td>Otto</td>
                        <td>@mdo</td>
                        <td>@mdo</td>
                        <td>@mdo</td>
                        <td>@mdo</td>
                    </tr>
                </tbody>
                </table>
            </div>
        </div>
        <div class="row d-none" id="questionnaireViewBlock">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
            <table class="table table-hover table-dark">
                <thead>
                    <tr>
                    <th scope="col">Index</th>
                    <th scope="col">飼主姓名</th>
                    <th scope="col">飼主性別</th>
                    <th scope="col">email</th>
                    <th scope="col">寵物年紀</th>
                    <th scope="col">品種</th>
                    <th scope="col">體態</th>
                    <th scope="col">icon選擇</th>
                    <th scope="col">飼養地點</th>
                    <th scope="col">生鮮食</th>
                    <th scope="col">罐頭</th>
                    <th scope="col">預防針</th>
                    </tr>
                </thead>
                <tbody id="questionnaireViewInfo">
                    <tr>
                        <th scope="row">1</th>
                        <td>Mark</td>
                        <td>Otto</td>
                        <td>@mdo</td>
                        <td>@mdo</td>
                        <td>@mdo</td>
                        <td>@mdo</td>
                        <td>@mdo</td>
                        <td>@mdo</td>
                        <td>@mdo</td>
                        <td>@mdo</td>
                        <td>@mdo</td>
                    </tr>
                </tbody>
                </table>
            </div>
        </div>
    </div>
</body>
</html>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare[i].com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script>
    var whetherlogin = 0;
    var currentPage = 'homepage';
    var adminName;
    function EnterPress(){
        if (event.keyCode == 13){
            SendAdminInfo();
        }
    }
    function SendAdminInfo(){
        if($('#id').val()!='' && $('#pwd').val()!=''){
            $.ajax({
                method: 'POST',
                url: 'adminLogin',
                data: {
                    id: $('#id').val(),
                    pwd: $('#pwd').val()
                }
            }).done(function(data){
                if(data=='error'){
                    whetherlogin = 0;
                    alert('管理員帳號密碼錯誤!');
                    window.location.href = '/admin/avoidsearching';
                }else{
                    whetherlogin = 1;
                    var sp = data.split('#');
                    $('#loginBlock').toggleClass('d-none');
                    $('#homepageBlock').toggleClass('d-none');
                    adminName = sp[1];
                    document.getElementById('adminName').innerHTML = adminName;
                    alert('登入成功!歡迎你，'+sp[1]);
                }
            });
        }
    }
    function ChangePage(id){
        if(id!=currentPage && whetherlogin==1){
            $('#'+currentPage).toggleClass('active');
            $('#'+currentPage+'Block').toggleClass('d-none');
            currentPage = id;
            $('#'+currentPage).toggleClass('active');
            $('#'+currentPage+'Block').toggleClass('d-none');
            if(currentPage=='customerAccount'){
                $.ajax({
                    method: 'POST',
                    url: 'adminAskCustomer'
                }).done(function(data){
                    var re = JSON.parse(data);
                    var innerHTML = '';
                    for(i in re){
                        innerHTML += '<tr><th scope="row">'+re[i].CCMUserPId+'</th><td>'+re[i].name+'</td><td>'+re[i].username+'</td><td>'+re[i].password+'</td><td>'+re[i].buildtime+'</td><td>'+re[i].whetherCommand+'</td><td>'+re[i].possiblePurchaseCatFood+'</td></tr>';
                    }
                    document.getElementById('customerAccountInfo').innerHTML = innerHTML;
                });
            }
            if(currentPage=='questionnaireView'){
                $.ajax({
                    method: 'POST',
                    url: 'adminAskQuestionnaire'
                }).done(function(data){
                    var re = JSON.parse(data);
                    var innerHTML = '';
                    for(i in re){
                        innerHTML += '<tr><th scope="row">'+re[i].CCMUserqnrPId+'</th><td>'+re[i].BKN_name+'</td><td>'+re[i].BKN_sex+'</td><td>'+re[i].BEMAIL+'</td><td>'+re[i].BCA_ageYear+'.'+re[i].BCA_ageMonth+'</td><td>'+re[i].BSP+'</td><td>'+re[i].BBC+'</td><td>'+re[i].select_icon+'</td><td>'+re[i].extra_place+'</td><td>'+re[i].extra_freshflesh+'</td><td>'+re[i].extra_weekcan+'</td><td>'+re[i].extra_vacci+'</td></tr>';
                    }
                    document.getElementById('questionnaireViewInfo').innerHTML = innerHTML;
                });
            }
        }
    }
</script>